<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="boot.css">
    <title>ورود</title>
    <style>
        body,
        html {
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="message_card">
        کد وارد شده اشتباه است
    </div>
    <div class="login-page">
        <div class="header-login">
            <div class="header">
    <div class="pc-header row">
        <div class="right-header-icons col-6">
            <a href="history.html">
                <div class="header-button">
                    <img src="images/home.svg">
                    <span>صفحه اصلی</span>
                </div>
            </a>
            <a href="gift.html?num=2#">
                <div class="header-button">
                    <img src="images/buy.svg">
                    <span>خرید</span>
                </div>
            </a>
            <a href="history.html#info" onclick="check_url_nows()">
                <div class="header-button">
                    <img src="images/about.svg">
                    <span>درباره ما</span>
                </div>
            </a>
            <a href="rules.html">
                <div class="header-button">
                    <img src="images/rule.svg">
                    <span>قوانین</span>
                </div>
            </a>
        </div>

        <div class="left-header-profile col-6">
        <a href= "https://tehranswap.com/%E2%80%9Ctel:+9821225854" class="mrs232">
                <div class="profile-button msb2">
                    <img src="images/phones.svg">
                    <div>
                       021225854
                    </div>
                </div>
            </a>
            <a href="history.html">

                <div class="payment-history">
                    <img src="images/cash.svg">
                    تاریخچه تراکنش ها
                </div>
            </a>
                        <a href="gift.html?num=2">
                <div class="profile-button">
                    <img src="images/user.svg">
                    ورود                </div>
            </a>
        </div>
    </div>

    <div class="mobile-header">
        <div class="row">
            <div class="col-8">
                <div class="mobile-header-title">
                    <a href="history.html">
                        تهران‌سواپ
                    </a>
                </div>
            </div>
            <div class="col-4 ham-menu" id="menu_btn">
                <img src="images/menu.png">
            </div>
        </div>
        <div class="mobile-menu" id="mobile_menu">
            <a href="history.html">
                <div class="header-button">
                    <img src="images/home.svg">
                    <span>صفحه اصلی</span>
                </div>
            </a>
            <a href="gift.html?num=2">
                <div class="header-button whitimg">
                    <img src="images/user.svg">
                    <span>ورود</span>
                </div>
            </a>
            <a href="history.html">
                <div class="header-button">
                    <img src="images/cash.svg">
                    <span>تاریخچه تراکنش ها</span>
                </div>
            </a>
            <a href="gift.html?num=2#">
                <div class="header-button">
                    <img src="images/buy.svg">
                    <span>خرید</span>
                </div>
            </a>
            <div class="header-button">
                <img src="images/about.svg">
                <span>درباره ما</span>
            </div>
            <a href="rules.html">
                <div class="header-button">
                    <img src="images/rule.svg">
                    <span>قوانین</span>
                </div>
            </a>
            <a href="phone:02128424851" class="mrs232">
                <div class="profile-button msb2">
                    <img src="images/phones.svg">
                    <div>
                        02128424851
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

<script>
    
    const header_btn = document.getElementsByClassName('header-button');
    const menu_btn = document.getElementById('menu_btn');
    const menu = document.getElementById('mobile_menu');
    var path = window.location.pathname;
    switch (path) {
        case '/':
            header_btn[0].classList.add('header-button-active');
            break;
        case '/shop.html':
            header_btn[1].classList.add('header-button-active');
            break;
        case '/rules.html':
            header_btn[3].classList.add('header-button-active');
            break;
        default:
            break;
    }

    var menu_open = false;
    menu_btn.addEventListener('click', function() {
        if (menu_open == false) {
            menu.style.maxHeight = '400px';
            menu_open = true;
        } else {
            menu.style.maxHeight = '0px';
            menu_open = false;
        }
    });

    function check_url_nows() {
        const ele = document.getElementById('info_page');
        ele.scrollIntoView();
    }
</script>        </div>
        <div class="body-login">
            <div class="login-card">
                <div class="login-details">
                    <div class="login-title">
                        <div class="login-title-text">
                            ورود
                        </div>
                        <div class="login-title-border"></div>
                        <div class="login-des">
                            شماره تلفن خود را وارد کنید
                        </div>
                    </div>
                    <div class="login-number">
                        <input id="number-input" class="number-input m4" type="number" placeholder="به عنوان مثال : 09024585400" pattern="\d*">
                        <div id="number-status" class="number-status m4">
                            شماره وارد نشده
                        </div>
                    </div>
                    <div class="login-rules">
                        <div id="login-checkbox" class="login-checkbox"></div>
                        <div class="login-rule-text">
                            <span><a href="rules.html">قوانین و مقررات</a></span> تهران‌سواپ را مطالعه کردم و آنها را میپذیرم.
                        </div>
                    </div>
                </div>
                <div class="login-btns">
                    <div id="send-sms-btn" class="send-sms-btn">
                        <div>
                            درحال حاضر ورود غیرفعال است
                        </div>
                        <div class="loading-circle">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-login">
            <div class="footer">
    <div class="row">
        <div class="col-3 pt-3 ftsse">
            <div class="footer-right-border2"></div>
            <div class="contact-foot">
                <div class="ft-2">
                    <b>آدرس‌:‌</b>         بوشهر محله: مرکز شهر، خیابان امام خمینی، خیابان جمهوری، پلاک: ۸ کاوه، طبقه: ۱ واحد:‌ ۲
                </div>
                <div class="ft-2">
                    <b>شماره تماس</b> : +9821225854
                </div>
                <div class="footer-right-border22"></div>
            </div>
        </div>
        <div class="col-6 footer-about m4">
            <div class="row">
                <div class="footer-right-border disable"></div>
                <div class="col-4 m4">
                    <div class="footer-about-me">
                        بیشتر بدانید
                        <ul>
                            <a href="history.html#info">
                                <li onclick="check_url_nows()">
                                    درباره ما
                                </li>
                            </a>
                            <a href="rules.html">
                                <li>
                                    شرایط و قوانین
                                </li>
                            </a>
                            <a href="history.html#qa">
                                <li onclick="check_qa_row()">
                                    سوالات متداول
                                </li>
                            </a>
                        </ul>
                    </div>
                </div>
                <div class="col-4 m4">
                    <div class="footer-right-border"></div>
                    <div class="footer-social">
                        <div class="footer-social-title">
                            شبکه های اجتماعی ما
                        </div>
                        <div class="footer-social-des">
                            ما را در شبکه های اجتماعی دنبال کنید
                        </div>
                    </div>
                    <div class="footer-social-icons">
                        <a href="https://t.me/Mrswap_official"><img src="images/telegram.svg"></a>
                        <img src="images/instagram.svg">
                        <img src="images/twiiter.svg">
                    </div>
                </div>
                <div class="col-4 m4 footer-support">
                    <div class="footer-right-border"></div>
                    <div>
                        <div class="footer-support-title">
                            پشتیبانی
                        </div>
                        <div class="footer-support-des">
                            سوال یا مشکلی پیش آمده ؟
                        </div>
                        <a href="https://t.me/tehranswap">
                            <div class="footer-support-button">
                                <img src="images/support.svg">
                                ارتباط با پشتیبانی
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>        </div>
    </div>
    <script>
        const number = document.getElementById('number-input');
        const number_status = document.getElementById('number-status');
        const send_btn = document.getElementById('send-sms-btn');
        const message_card = document.getElementById('message_card');

        number_check = false;
        checkbox_check = false;
        number.addEventListener('input', function() {
            send_btn.classList.remove('active-send-sms');
            if (number.value == "") {
                number_status.classList.remove('number-box-error');
                number_status.classList.remove('number-box-success');
                number_status.textContent = 'شماره وارد نشده';
                number_check = false;
            } else if (number.value.length == 11) {
                if (number.value.substring(0, 2) == "09") {
                    number_status.classList.remove('number-box-error');
                    number_status.classList.add('number-box-success');
                    number_status.textContent = 'شماره درست است';
                    number_check = true;
                    if (checkbox_check == true) {
                        send_btn.classList.add('active-send-sms');
                    } else {
                        send_btn.classList.remove('active-send-sms');
                    }
                } else {
                    number_status.classList.remove('number-box-success');
                    number_status.classList.add('number-box-error');
                    number_status.textContent = 'شماره نامعتبر است';
                    number_check = false;
                }
            } else {
                number_status.classList.remove('number-box-success');
                number_status.classList.add('number-box-error');
                number_status.textContent = 'شماره نامعتبر است';
                number_check = false;
            }
        })

        const checkbox = document.getElementById('login-checkbox');
        checkbox.addEventListener('click', function() {
            if (this.classList.contains('checkbox-clicked')) {
                this.classList.remove('checkbox-clicked');
                checkbox_check = false;
                send_btn.classList.remove('active-send-sms');
            } else {
                this.classList.add('checkbox-clicked');
                checkbox_check = true;
                if (number_check == true) {
                    send_btn.classList.add('active-send-sms');
                }
            }
        });

        var btn_cl = false;
        send_btn.addEventListener('click', function() {

            const url = window.location.search;
            const urlParams = new URLSearchParams(url);
            const wallet = urlParams.get('wallet');
            const sessionte = urlParams.get('session');
            const num_wallet = urlParams.get('num');
            
            if (checkbox_check == true & number_check == true & btn_cl == false) {
                btn_cl = true;
                this.children[0].style.display = 'none';
                this.children[1].style.display = 'block';
                fetch('./api/login.html', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: 'number=' + number.value
                    })
                    .then(response => {
                        if (response.status == 200) {
                            response.text().then(text => {
                                if (wallet != null & num_wallet != null & isNaN(num_wallet) == false) {
                                    window.location.href = "./verify.html?hash=" + text + "&wallet="+wallet +"&num=" + num_wallet+"&session=" + sessionte;
                                }else {
                                    window.location.href = "./verify.html?hash=" + text;
                                }
                            });
                        } else {
                            message_card.classList.add('message_card_error');
                            message_card.textContent = "خطا در برقراری ارتباط";
                            setTimeout(() => {
                                message_card.classList.remove('message_card_error');
                                this.children[0].style.display = 'block';
                                this.children[1].style.display = 'none';
                                var btn_cl = false;
                            }, 2000);
                        }
                    }).catch(error => {
                        this.children[0].style.display = 'block';
                        this.children[1].style.display = 'none';
                        var btn_cl = false;
                    });

            }
        });

        const input = document.getElementById('number-input');

        input.addEventListener('input', () => {
            input.value = input.value.replace(/[^0-9]/g, '');
        });
    </script>
</body>

</html>